<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>ponscr-syntax</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.0"><link rel="home" href="index.html" title=""><link rel="up" href="rn01.html" title="Ponscripter manual"><link rel="prev" href="rn01re02.html" title="ponscr"><link rel="next" href="rn01re04.html" title="ponscr-ext"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">ponscr-syntax</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="rn01re02.html">Prev</a> </td><th width="60%" align="center">Ponscripter manual</th><td width="20%" align="right"> <a accesskey="n" href="rn01re04.html">Next</a></td></tr></table><hr></div><div class="refentry"><a name="ponscr-syntax.7"></a><div class="titlepage"></div>
  
  

  <div class="refnamediv"><h2>Name</h2><p>
    ponscr-syntax — description of Ponscripter syntax
  </p></div>

  <div class="refsect1"><a name="idm139832484477664"></a><h2>Description</h2>
    
    <p>
      This page documents the syntax of Ponscripter scripts.  See
      <a class="link" href="rn01re01.html" title="ponscripter">Overview</a> for an overview of other documentation.
    </p><p>
      Note that this cannot be considered NScripter documentation.
      NScripter itself is largely unspecified.  Ponscripter's
      implementation is ultimately based on observation and
      documentation rather than on reverse-engineering as such: it
      inevitably adopts different parsing strategies, and is more
      liberal in what it accepts.  Not all differences are described
      below.  With this disclaimer out of the way: the documentation.
    </p><div class="refsect2"><a name="idm139832484472896"></a><h3>Fundamentals</h3>
      
      <p>
        Scripts are line-based.
      </p><p>
        There are two parsing modes: <em class="firstterm">command
        mode</em> and <em class="firstterm">text mode</em>.
        Parsing of each line begins in command mode, and switches to
        text mode for the rest of the line if a text command is
        encountered.
      </p><p>
        The two parsing modes have little in common.  The following
        sections discuss command mode first; text mode is then treated
        separately.
      </p><p>
        A third mode, <span class="quote">“<span class="quote">unmarked text</span>”</span>, exists for legacy
        reasons.  This mode is similar to text mode, and is entered if
        an invalid character is encountered at the start of a command:
        that is, a number, a character outside the ASCII range, or
        anything in the set <code class="literal">[[@\/%?$(!#,]</code>.  Such
        lines are valid if they contain <span class="emphasis"><em>only</em></span>
        <code class="code">!</code>-commands; otherwise a warning is issued, and
        the behaviour is undefined.
      </p><p>
        (This mode derives from NScripter, where traditionally there
        was no intersection between printable characters and command
        characters; the <code class="code">`</code> text marker was introduced in
        ONScripter as a means of supporting English text, and replaced
        in Ponscripter with <code class="code">^</code> to free up <code class="code">`</code>
        for other uses.  Since unmarked text serves no useful purpose,
        and complicates parsing, it is deprecated and will be removed
        without notice at some point in the future.)
      </p></div>

    <div class="refsect2"><a name="idm139832484466224"></a><h3>Context</h3>
      
      <p>
        NScripter is a context-sensitive language.  Each parameter to
        a command may be parsed differently based on the type of that
        parameter.  The major types are <span class="type">string</span> and
        <span class="type">integer</span>, with labels and barewords being special
        cases of string parameters.
      </p><p>
        String expressions do not merely have a different type from
        integer expressions, as in other languages: they have a
        distinct syntax.  Some string expressions can be parsed as
        integer expressions, but then leave code unparsed that will
        cause a syntax error when it is reached.  It is impossible, in
        the general case, to parse a line of code unless it is known
        in advance what context each parameter is using.
      </p><p>
        For example, given the following definitions:
        </p><pre class="programlisting"><code class="function">numalias</code> foo, 100
<code class="function">stralias</code> foo, "bar"</pre><p>
        the constant <code class="constant">foo</code> would have the value
        <code class="literal">100</code> in integer context, but
        <code class="literal">"bar"</code> in string context.
      </p><p>
        See the next section for more on constants, and
        <a class="link" href="rn01re03.html#expression-syntax" title="Expression syntax">Expression syntax</a> below for
        details of the syntax accepted in each context.
      </p></div>

    <div class="refsect2"><a name="lex-cat"></a><h3>Lexical categories</h3>
      
      <p>
        The following broad lexical categories are used in command
        mode (parenthesised names are used in syntax descriptions
        below):
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="firstterm">Comments</em></span></dt><dd>
            
              are introduced with a semicolon, and last to the end of
              the line.
            </dd><dt><span class="term">
            <em class="firstterm">Barewords</em>
            (<em class="replaceable"><code>bareword</code></em>)
          </span></dt><dd>
            <p class="simpara">
              have the same syntax as identifiers in most programming
              languages: the first character must be in the set
              <code class="literal">[A-Za-z_]</code>, and the remainder must be
              in the set <code class="literal">[A-Za-z0-9_]</code>.
            </p><p class="simpara">
              A bareword at the start of a line, or immediately
              following a colon, is assumed to be a command.
              Otherwise their interpretation is context-sensitive:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
                
                  If an alias exists of the desired type (a
                  <span class="type">numalias</span> in number context, or a
                  <span class="type">stralias</span> in string context) then the
                  bareword acts as a constant, and the value of the
                  alias is substituted.
                </li><li class="listitem">
                
                  In string context where no stralias exists, the
                  bareword itself is treated as a string; it will be
                  transformed to lower case and substituted directly.
                </li><li class="listitem">
                
                  In number context where no numalias exists, a
                  warning is issued and 0 is substituted.
                </li><li class="listitem">
                
                  Some commands, such as <code class="function">rmenu</code>,
                  <code class="function">ld</code>, and
                  <code class="function">systemcall</code>, look for barewords
                  directly for certain parameters; in these cases
                  aliases are not resolved.
                </li></ul></div>
          </dd><dt><span class="term">
            <em class="firstterm">String literals</em>
            (<em class="replaceable"><code>str_lit</code></em>)
          </span></dt><dd>
            <p class="simpara">
              are formed in two ways.They may be enclosed in regular
              double quotes, or in pairs of the text delimiter
              (<code class="code">^</code> in native scripts, <code class="code">`</code> in
              legacy scripts).
            </p><p class="simpara">
              The two forms have slightly different semantics.
              Strings enclosed in text delimiters support
              <code class="code">~</code>-tags (described under
              <a class="link" href="rn01re03.html#text-mode" title="Text mode">text mode</a> below) to apply text
              formatting, while tildes are literal characters in
              double-quoted strings.
            </p><p class="simpara"><span class="strong"><strong>Note:</strong></span> this differs
              from ONScripter (and some pre-release versions of
              Ponscripter), where double-quoted strings had semantics
              similar to unmarked text: in particular, whitespace was
              ignored.
            </p><p class="simpara">
              In these interpreters, whitespace could be made
              significant in double-quoted text by following the
              opening quote with a text delimiter.  This no longer
              has any effect, but is still supported for
              backwards-compatibility: the text delimiter is
              ignored, and the construct is equivalent to a
              double-quoted string.
            </p></dd><dt><span class="term">
            <em class="firstterm">Numeric literals</em>
            (<em class="replaceable"><code>num_lit</code></em>)
          </span></dt><dd>
            <p class="simpara">
              are straightforward.
            </p><p class="simpara">
              Unlike NScripter, which accepts only decimal integers,
              Ponscripter also understands the C-style
              <code class="literal">0x<em class="replaceable"><code>NN</code></em></code>
              notation for hexadecimal numbers.
            </p></dd><dt><span class="term">
            <em class="firstterm">Label literals</em>
            (<em class="replaceable"><code>label</code></em>)
          </span></dt><dd>
            <p class="simpara">
              have the general format
              <code class="code">*<em class="replaceable"><code>bareword</code></em></code>.  They
              are used to mark and provide targets for jump commands
              (<code class="function">goto</code>, <code class="function">csel</code>, etc)
              and for the construction of subroutines with commands
              such as <code class="function">defsub</code>,
              <code class="function">textgosub</code>, etc.
            </p><p class="simpara">
              (In NScripter, label literals are a distinct type that
              can only be used where a command is expecting a label.
              ONScripter also accepts them wherever a string is
              expected: <code class="literal">*foo</code> means roughly the same
              thing as <code class="literal">"foo"</code>.)
            </p></dd><dt><span class="term">
            <em class="firstterm">Colour literals</em>
            (<em class="replaceable"><code>colour</code></em>)
          </span></dt><dd>
            <p class="simpara">
              have the general format
              <code class="code">#<em class="replaceable"><code>RRGGBB</code></em></code>, where
              <em class="replaceable"><code>RR</code></em>,
              <em class="replaceable"><code>GG</code></em>, and
              <em class="replaceable"><code>BB</code></em> are each two hex digits.
              These represent colours in the standard way.
            </p><p class="simpara">
              (In NScripter, colour literals are a distinct type that
              can only be used where a command is expecting a colour.
              ONScripter also accepts them wherever a string is
              expected:
              <code class="literal">#<em class="replaceable"><code>RRGGBB</code></em></code>
              means exactly the same thing as
              <code class="literal">"#<em class="replaceable"><code>RRGGBB</code></em>"</code>.)
            </p></dd><dt><span class="term">
            <em class="firstterm">Variables</em>
            (<em class="replaceable"><code>int_var</code></em>,
             <em class="replaceable"><code>str_var</code></em>)
          </span></dt><dd>
            <p class="simpara">
              take the form of a sigil followed by either a number, a
              bareword (which must have been defined with
              <code class="function">numalias</code>), or an integer variable
              (with sigil) for indirect access.
            </p><p class="simpara">
              The sigils are <code class="code">%</code> for integer variables,
              <code class="code">?</code> for integer arrays, and <code class="code">$</code>
              for string variables.
            </p><p class="simpara">
              Hence <code class="varname">%200</code> (an integer variable),
              <code class="varname">$%foo</code> (the string variable indexed by
              the current value of <code class="varname">%foo</code>), and
              <code class="code"><code class="varname">?bar</code>[9][4]</code>
              (dereferencing the multidimensional array
              <code class="varname">?bar</code>).
            </p><p class="simpara">
              Variable syntax is expressed formally in the expression
              sections below.
            </p></dd></dl></div>
    </div>

    <div class="refsect2"><a name="expression-syntax"></a><h3>Expression syntax</h3>
      
      
      <div class="variablelist"><dl class="variablelist"><dt><span class="term">
            <em class="firstterm">Integer expressions</em>
            (<em class="replaceable"><code>int_expr</code></em>)
          </span></dt><dd>
            <p>
              are similar to those in other languages.  The syntax is
              infix.  There are two operator precedence levels:
              <code class="code">*</code>, <code class="code">/</code>, and <code class="code">mod</code> are
              processed before <code class="code">+</code> and <code class="code">-</code>.
              Parentheses and unary minus operate as normal.
            </p><p>More formally:</p><div class="informaltable"><table border="0" rules="none">
              <tbody>
                <tr>
                  <td><em class="firstterm">int_expr</em></td><td>::=</td>
                  <td><em class="replaceable"><code>int_term</code></em> <em class="replaceable"><code>binary_op</code></em> <em class="replaceable"><code>int_expr</code></em></td>
                </tr>
                <tr>
                  <td><em class="firstterm">int_term</em></td><td>::=</td>
                  <td><em class="replaceable"><code>int_paren</code></em> | <span class="quote">“<span class="quote">-</span>”</span> <em class="replaceable"><code>int_paren</code></em></td>
                </tr>
                <tr>
                  <td><em class="firstterm">int_paren</em></td><td>::=</td>
                  <td><span class="quote">“<span class="quote">(</span>”</span> <em class="replaceable"><code>int_expr</code></em> <span class="quote">“<span class="quote">)</span>”</span> | <em class="replaceable"><code>int_elt</code></em></td>
                </tr>
                <tr>
                  <td><em class="firstterm">int_elt</em></td><td>::=</td>
                  <td>
                    <em class="replaceable"><code>num_lit</code></em> | <em class="replaceable"><code>int_var</code></em> | <em class="replaceable"><code>bareword</code></em>
                  </td>
                </tr>
                <tr>
                  <td><em class="firstterm">int_var</em></td><td>::=</td>
                  <td>
                    <span class="quote">“<span class="quote">%</span>”</span> <em class="replaceable"><code>int_elt</code></em> | <span class="quote">“<span class="quote">?</span>”</span> <em class="replaceable"><code>int_elt</code></em> <em class="replaceable"><code>subscript</code></em>+
                  </td>
                </tr>
                <tr>
                  <td><em class="firstterm">subscript</em></td><td>::=</td>
                  <td>
                    <span class="quote">“<span class="quote">[</span>”</span> <em class="replaceable"><code>int_expr</code></em> <span class="quote">“<span class="quote">]</span>”</span>
                  </td>
                </tr>
                <tr>
                  <td><em class="firstterm">binary_op</em></td><td>::=</td>
                  <td>
                    <span class="quote">“<span class="quote">*</span>”</span> | <span class="quote">“<span class="quote">/</span>”</span> | <span class="quote">“<span class="quote">mod</span>”</span> | <span class="quote">“<span class="quote">+</span>”</span> | <span class="quote">“<span class="quote">-</span>”</span>
                  </td>
                </tr>
                <tr>
                  <td><em class="firstterm">num_lit</em></td><td>::=</td>
                  <td>
                    <code class="literal">[0-9]+</code> | <code class="literal">0x[0-9A-Fa-f]+</code>
                  </td>
                </tr>
                <tr>
                  <td><em class="firstterm">bareword</em></td><td>::=</td>
                  <td>
                    <code class="literal">[A-Za-z_][A-Za-z_0-9]*</code>
                  </td>
                </tr>
              </tbody>
            </table></div>
          </dd><dt><span class="term">
            <em class="firstterm">String expressions</em>
            (<em class="replaceable"><code>str_expr</code></em>)
          </span></dt><dd>
            <p>
              are simpler.  Their grammar is as follows:
            </p><div class="informaltable"><table border="0" rules="none">
              <tbody>
                <tr>
                  <td><em class="firstterm">str_expr</em></td><td>::=</td>
                  <td>
                    <em class="replaceable"><code>str_elt</code></em> | <em class="replaceable"><code>str_elt</code></em> <span class="quote">“<span class="quote">+</span>”</span> <em class="replaceable"><code>str_expr</code></em>
                  </td>
                </tr>
                <tr>
                  <td><em class="firstterm">str_elt</em></td><td>::=</td>
                  <td>
                    <em class="replaceable"><code>file_cond</code></em> | <em class="replaceable"><code>str_lit</code></em> | <em class="replaceable"><code>str_var</code></em> | <em class="replaceable"><code>label</code></em> | <em class="replaceable"><code>colour</code></em> | <em class="replaceable"><code>bareword</code></em>
                  </td>
                </tr>
                <tr>
                  <td><em class="firstterm">file_cond</em></td><td>::=</td>
                  <td>
                    <span class="quote">“<span class="quote">(</span>”</span> <em class="replaceable"><code>str_term</code></em> <span class="quote">“<span class="quote">)</span>”</span> <em class="replaceable"><code>str_term</code></em> <em class="replaceable"><code>str_term</code></em>
                  </td>
                </tr>
                <tr>
                  <td><em class="firstterm">str_var</em></td><td>::=</td>
                  <td>
                    <span class="quote">“<span class="quote">$</span>”</span> <em class="replaceable"><code>int_elt</code></em>
                  </td>
                </tr>
                <tr>
                  <td><em class="firstterm">str_lit</em></td><td>::=</td>
                  <td>
                    <code class="literal">"[^"]*?"</code> | <code class="literal">^[^^]*?^</code>
                  </td>
                </tr>
                <tr>
                  <td><em class="firstterm">label</em></td><td>::=</td>
                  <td>
                    <span class="quote">“<span class="quote">*</span>”</span> <code class="literal">[A-Za-z_0-9]+</code>
                  </td>
                </tr>
                <tr>
                  <td><em class="firstterm">colour</em></td><td>::=</td>
                  <td>
                    <span class="quote">“<span class="quote">#</span>”</span> <code class="literal">[0-9A-Fa-f]{6}</code>
                  </td>
                </tr>
              </tbody>
            </table></div>
            <p>
              The only part of the above that should not be obvious, given
              the descriptions under <a class="link" href="rn01re03.html#lex-cat" title="Lexical categories">Lexical categories</a>
              above, is the <em class="replaceable"><code>file_cond</code></em> term.  This
              is only useful when the <code class="function">filelog</code> command
              is in effect.  The parenthesised string is interpreted as the
              name of an image file.  If the player has viewed this file,
              the first of the subsequent terms is used; otherwise, the
              second is used.
            </p></dd><dt><span class="term">
            <em class="firstterm">Conditional expressions</em>
            (<em class="replaceable"><code>conditional</code></em>)
          </span></dt><dd>
            <p>
              are effectively a special syntax associated with the
              <code class="function">if</code> / <code class="function">notif</code>
              commands.
            </p><p>
              They are somewhat lacking compared to conditionals in
              most languages: in particular, multiple terms may be
              combined only with an <span class="quote">“<span class="quote">and</span>”</span> operator, with
              no <span class="quote">“<span class="quote">or</span>”</span> available.
            </p><p>
              Either strings or integers may be compared.  The
              ordering of strings is deliberately left undefined; it
              may change without warning in the future.  However, for
              any given Ponscripter version, the ordering will be the
              same across all platforms and will not be affected by
              users' locale settings.
            </p><p>
              The operators are C-style: <code class="code">==</code> and
              <code class="code">!=</code> for equality and inequality;
              <code class="code">&lt;</code>, <code class="code">&lt;=</code>,
              <code class="code">&gt;</code>, and <code class="code">&gt;=</code> for ordering;
              and <code class="code">&amp;</code> to combine terms with a logical
              <span class="quote">“<span class="quote">and</span>”</span>.
            </p><p>
              (Several operators accept variant forms:
              <code class="code">&amp;&amp;</code> for <code class="code">&amp;</code>,
              <code class="code">=</code> for <code class="code">==</code>, and
              <code class="code">&lt;&gt;</code> for <code class="code">!=</code>.  These
              variants have no semantic difference from the canonical
              forms.)
            </p><p>
              Functions cannot be called from conditional expressions
              (you must assign the result of a function to a variable,
              and compare that manually), with one exception: there is
              hardcoded support for a function
              <code class="function">fchk</code>, which takes a string,
              interprets it as the filename of a picture, and returns
              true iff that picture has been displayed.  (This is
              analogous to the <em class="replaceable"><code>file_cond</code></em>
              term in string expressions.)
            </p><p>
              The grammar is:
            </p><div class="informaltable"><table border="0" rules="none">
              <tbody>
                <tr>
                  <td><em class="firstterm">conditional</em></td><td>::=</td>
                  <td>
                    <em class="replaceable"><code>cond_term</code></em> | <em class="replaceable"><code>cond_term</code></em> <span class="quote">“<span class="quote">&amp;</span>”</span> <em class="replaceable"><code>conditional</code></em>
                  </td>
                </tr>
                <tr>
                  <td><em class="firstterm">cond_term</em></td><td>::=</td>
                  <td>
                    <em class="replaceable"><code>comp_term</code></em> | <span class="quote">“<span class="quote">fchk</span>”</span> <em class="replaceable"><code>str_expr</code></em>
                  </td>
                </tr>
                <tr>
                  <td><em class="firstterm">comparison</em></td><td>::=</td>
                  <td>
                    <em class="replaceable"><code>expression</code></em> <em class="replaceable"><code>comp_op</code></em> <em class="replaceable"><code>expression</code></em>
                  </td>
                </tr>
                <tr>
                  <td><em class="firstterm">expression</em></td><td>::=</td>
                  <td>
                    <em class="replaceable"><code>int_expr</code></em> | <em class="replaceable"><code>str_expr</code></em>
                  </td>
                </tr>
                <tr>
                  <td><em class="firstterm">comp_op</em></td><td>::=</td>
                  <td>
                    <span class="quote">“<span class="quote">==</span>”</span> | | <span class="quote">“<span class="quote">!=</span>”</span> | <span class="quote">“<span class="quote">&gt;</span>”</span> | <span class="quote">“<span class="quote">&gt;=</span>”</span> | <span class="quote">“<span class="quote">&lt;</span>”</span> | <span class="quote">“<span class="quote">&lt;=</span>”</span>
                  </td>
                </tr>
              </tbody>
            </table></div>
          </dd></dl></div>
    </div>

    <div class="refsect2"><a name="idm139832484316672"></a><h3>Command syntax</h3>
      
      <p>
        The above lexemes and expressions are combined in a fairly
        similar way to BASIC.  Commands are interpreted sequentially,
        one to a line; multiple commands may be placed on a single
        line, where required, by separating them with colons.
      </p><p>
        There are several forms of command:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
            <em class="firstterm">Procedure call</em>s consist of a
              bareword, normally followed by a parameter list: this is
              a comma-separated list of expressions (parentheses are
              not used).
            </li><li class="listitem">
            <p class="simpara"><em class="firstterm">Label</em>s consist of a label
              literal, which serves as a name for that point in the
              script.
            </p><p class="simpara">
              There is also a form of anonymous label, represented by
              a single <code class="code">~</code> character, which is used by the
              <span class="command"><strong>jumpf</strong></span> and <span class="command"><strong>jumpb</strong></span>
              commands.
            </p></li><li class="listitem">
            <em class="firstterm">Text</em> commands consist of a text
              delimiter, which switches the interpreter into text mode
              for the remainder of the line; see next section.
            </li></ul></div></div>

    <div class="refsect2"><a name="text-mode"></a><h3>Text mode</h3>
      
      <p>
        As described above, text commands begin with a text marker
        (<code class="code">^</code> in native scripts, <code class="code">`</code> in legacy
        scripts).  The remainder of the line is then parsed in text
        mode.
      </p><p>
        Most characters in text mode represent themselves and are
        printed verbatim; this includes the newline at the end of each
        line, unless it is explicitly suppressed with <code class="code">/</code>.
        It also includes characters with special meanings in command
        mode, such as colons and semicolons.
      </p><p>
        However, there are also a fair number of control characters
        with special meanings.  Since text syntax was not so much
        designed as gradually accumulated, there is very little
        consistency in how these control characters are chosen, when
        exactly in the parsing process they are interpreted, and how
        they are printed literally.  Read on for details.
      </p></div>

    <div class="refsect2"><a name="idm139832484305024"></a><h3>Text control</h3>
      
      <p>
        Single characters with special meanings.  These characters may
        all be printed literally by prefixing them with a single hash
        character, i.e. <code class="literal">#@</code>, <code class="literal">#_</code>,
        etc.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">@</code></span></dt><dd>
            
              Waits for click, then continues printing text as though
              nothing had happened.  (Unlike in many ONScripter
              builds, the behaviour of <code class="literal">@</code> is not altered
              by the definition of a <code class="function">textgosub</code>
              routine.)
            </dd><dt><span class="term"><code class="literal">\</code></span></dt><dd>
            
              Waits for a click, then clears the text window and
              begins a new page.
            </dd><dt><span class="term"><code class="literal">_</code></span></dt><dd>
            
              If a character has the <code class="function">clickstr</code>
              nature, prefixing it with an underscore suppresses that
              behaviour; otherwise it does nothing whatsoever.
              <code class="function">clickstr</code> is evil, so you should
              never need to use this.  Place your pauses explicitly.
            </dd><dt><span class="term"><code class="literal">/</code></span></dt><dd>
            
              At the end of a line, ends a text command without
              beginning a new line of display text.  This control only
              has any effect <span class="emphasis"><em>immediately</em></span> before a
              newline character.  Anywhere else in a line, even if
              only whitespace follows, it prints a literal slash.
            </dd></dl></div>
    </div>

    <div class="refsect2"><a name="idm139832484292128"></a><h3>Speed control</h3>
      
      <p>
        Multi-character control codes controlling text speed.
      </p><p>
        Whitespace after these codes is ignored; you can cause it to
        be treated literally by adding a trailing separator character,
        i.e. <code class="function">!sd</code><code class="literal">|</code> etc.
      </p><p>
        If one of these sequences would appear in literal text, it can
        be escaped by prefixing it with a single hash character, i.e.
        <code class="literal">#!sd</code> etc.
      </p><p>
        Due to existing conventions for script layout, these codes are
        also valid as standalone commands without a preceding text
        marker; in this case they must be the only thing on their line
        apart from whitespace.
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="function">!s</code><em class="replaceable"><code>NUM</code></em></span></dt><dd>
            <p>
              Sets text speed; this is equivalent to the commmand
              </p><pre class="programlisting"><code class="function">textspeed</code> <em class="replaceable"><code>NUM</code></em></pre><p>
              but has a more convenient syntax in cases where the
              speed must change within a single line.
            </p><p>
              Lower speeds are faster; <code class="literal">0</code> means
              there should be no deliberate delay between characters,
              though (as they are still printed one at a time) it may
              not quite lead to instantaneous display.
            </p></dd><dt><span class="term"><code class="function">!sd</code></span></dt><dd>
            <p>
              Resets text speed to the current player-selected
              default.
            </p></dd><dt><span class="term"><code class="function">!w</code><em class="replaceable"><code>NUM</code></em></span></dt><dd>
            <p>
              Inserts a pause of <em class="replaceable"><code>NUM</code></em>
              milliseconds.  It cannot be truncated by clicking, but
              can be skipped with any of the normal skip commands.
            </p></dd><dt><span class="term"><code class="function">!d</code><em class="replaceable"><code>NUM</code></em></span></dt><dd>
            <p>
              As <code class="function">!w</code>, but the pause can also be
              truncated by clicking.
            </p></dd></dl></div>
    </div>

    <div class="refsect2"><a name="idm139832484276736"></a><h3>Colour tags</h3>
      
      <p><code class="literal">#</code><em class="replaceable"><code>RRGGBB</code></em>, where
        <em class="replaceable"><code>RR</code></em>, <em class="replaceable"><code>GG</code></em>,
        and <em class="replaceable"><code>BB</code></em> are each two hex digits,
        modifies the current text foreground colour in the obvious
        way.  A literal hash character can be inserted with
        <code class="literal">##</code>.
      </p></div>

    <div class="refsect2"><a name="idm139832484273072"></a><h3>Formatting tags</h3>
      
      <p>
        All formatting other than text colour is performed with
        formatting tag blocks.  These are delimited with tildes; a
        literal tilde can be inserted with <code class="literal">~~</code>
        (<span class="emphasis"><em>not</em></span> <code class="literal">#~</code>... that would
        be consistent.)
      </p><p>
        Any number of tags can be combined within a single block,
        optionally separated with whitespace.
      </p><div class="variablelist"><dl class="variablelist"><dt><a name="f-sel-t"></a><span class="term">Font selection tags</span></dt><dd>
            <p>
              The tags in this section, with the exception of
              <code class="function">c</code>, assume that Ponscripter's eight
              font slots are assigned according to the following
              convention:
            </p><div class="literallayout"><p>  0 - text regular<br>
  1 - text italic<br>
  2 - text bold<br>
  3 - text bold italic<br>
  4 - display regular<br>
  5 - display italic<br>
  6 - display bold<br>
  7 - display bold italic<br>
</p></div>
            <p>
              If fonts are assigned in any other way, tags such as
              <code class="function">b</code> and <code class="function">i</code> will
              not behave as documented; you should use
              <code class="function">c</code> in this case.  Font slots are
              assigned using the <code class="function">h_mapfont</code>
              command, which is documented in <a class="link" href="rn01re04.html" title="ponscr-ext">Extensions</a>.
            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="function">c</code><em class="replaceable"><code>N</code></em></span></dt><dd>
                  
                    Selects the font in slot <em class="replaceable"><code>N</code></em></dd><dt><span class="term"><code class="function">d</code></span></dt><dd>
                  
                    Selects the default style (equivalent to
                    <code class="function">c0</code>)
                  </dd><dt><span class="term"><code class="function">r</code></span></dt><dd>
                  
                    Disables italics (default)
                  </dd><dt><span class="term"><code class="function">i</code></span></dt><dd>
                  
                    Toggles italics
                  </dd><dt><span class="term"><code class="function">t</code></span></dt><dd>
                  
                    Disables bold weight (default)
                  </dd><dt><span class="term"><code class="function">i</code></span></dt><dd>
                  
                    Toggles bold weight
                  </dd><dt><span class="term"><code class="function">f</code></span></dt><dd>
                  
                    Selects text face (default)
                  </dd><dt><span class="term"><code class="function">s</code></span></dt><dd>
                  
                    Toggles display face
                  </dd></dl></div>
          </dd><dt><span class="term">Text size</span></dt><dd>
            <p>
              In this section, the <em class="firstterm">base size</em>
              refers to the font size defined for the active window;
              the <em class="firstterm">current size</em> refers to that
              selected with previous size control tags.
            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="function">=</code><em class="replaceable"><code>N</code></em></span></dt><dd>
                  
                    Sets font size to exactly
                    <em class="replaceable"><code>N</code></em> pixels.
                  </dd><dt><span class="term"><code class="function">%</code><em class="replaceable"><code>N</code></em></span></dt><dd>
                  
                    Sets font size to <em class="replaceable"><code>N</code></em>% of
                    the base size.
                  </dd><dt><span class="term"><code class="function">+</code><em class="replaceable"><code>N</code></em></span></dt><dd>
                  
                    Increases current font size by
                    <em class="replaceable"><code>N</code></em> pixels.
                  </dd><dt><span class="term"><code class="function">-</code><em class="replaceable"><code>N</code></em></span></dt><dd>
                  
                    Decreases current font size by
                    <em class="replaceable"><code>N</code></em> pixels.
                  </dd></dl></div>
          </dd><dt><span class="term">Text position</span></dt><dd>
            <div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="function">x</code><em class="replaceable"><code>N</code></em></span></dt><dd>
                  
                    Sets the horizontal text position to a position
                    <em class="replaceable"><code>N</code></em> pixels right of the
                    left margin.
                  </dd><dt><span class="term"><code class="function">y</code><em class="replaceable"><code>N</code></em></span></dt><dd>
                  
                    Sets the vertical text position to a position
                    <em class="replaceable"><code>N</code></em> pixels below the
                    top margin.
                    </dd><dt><span class="term"><code class="function">x+</code><em class="replaceable"><code>N</code></em>, </span><span class="term"><code class="function">y+</code><em class="replaceable"><code>N</code></em></span></dt><dd>
                  
                    Adjusts the current horizontal or vertical text
                    position by <em class="replaceable"><code>N</code></em> pixels
                    right or down.
                  </dd><dt><span class="term"><code class="function">x-</code><em class="replaceable"><code>N</code></em>, </span><span class="term"><code class="function">y-</code><em class="replaceable"><code>N</code></em></span></dt><dd>
                  
                    Adjusts the current horizontal or vertical text
                    position by <em class="replaceable"><code>N</code></em> pixels
                    left or up.
                  </dd></dl></div>
          </dd><dt><span class="term">Indentation</span></dt><dd>
            <div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="function">n</code></span></dt><dd>
                  
                    Sets the indent to the current horizontal
                    position.  New text lines will start from this
                    offset until the end of the current page.
                  </dd><dt><span class="term"><code class="function">u</code></span></dt><dd>
                  
                    Resets the indent to the left margin.  This will
                    only affect <span class="emphasis"><em>subsequent</em></span> line
                    breaks; to end an indented section within a page,
                    position this at the end of the last line of the
                    indented section.
                  </dd></dl></div>
            <p>
              In addition to these tags, the indent is set
              automatically when the first character of a page is an
              <em class="firstterm">indent character.</em></p><p>
              The set of indent characters can be configured with the
              <code class="function">h_indentstr</code> command (described in
              <a class="link" href="rn01re04.html" title="ponscr-ext">Extensions</a>).  By default it includes opening quotes
              and em dashes.
            </p></dd><dt><span class="term">Formatting examples</span></dt><dd>
            <p>
              As an example of the usage of these tags, Narcissu 2's
              omake mode displays page headings at the top of each
              screen with code like
              </p><pre class="programlisting">^<code class="function">!s0</code>~i %120 x-20 y-40~Heading~i =0~<code class="function">!sd</code>
<code class="function">br2</code> 120</pre><p>
              Here the <code class="function">!s0</code> and
              <code class="function">!sd</code> are the usual NScripter
              commands.  The first tag block selects italic text, 120%
              of the regular font size, and shifts the output position
              up and to the left.  The second tag block cancels the
              italic effect and resets the font size to normal.
            </p><p>
              An example of indentation:
              </p><pre class="programlisting">^**%.Item 1
^Not indented
^**%.~n~Item 2
^Indented~u~
^Not indented</pre></dd></dl></div>
    </div>

    <div class="refsect2"><a name="ligs"></a><h3>Ligatures and shortcuts</h3>
      
      <p>
        To assist in typing Unicode scripts with ASCII keyboards,
        Ponscripter has the ability to replace sequences of characters
        with Unicode symbols.  This facility is also used to implement
        the hash-escaping of single-character control codes, and can
        be used to add ligatures automatically.  It is only enabled in
        native scripts; none of this is possible in legacy mode.
      </p><p>
        A shortcut is a mapping of a sequence of characters to a
        Unicode codepoint.

        </p><p>
        A shortcut sequence can be inserted literally by separating
        the characters with either a Unicode ZWNJ or a
        <code class="literal">|</code> character, e.g. <code class="literal">`|`</code> to
        insert two separate open single quotes.  A literal
        <code class="literal">|</code> can be inserted with
        <code class="literal">||</code>.
      </p><p>
        By default, the following character sequences are defined, in
        addition to the hash escapes described above:
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">``</code></span></dt><dd>open double quotes</dd><dt><span class="term"><code class="literal">''</code></span></dt><dd>close double quotes</dd><dt><span class="term"><code class="literal">`</code></span></dt><dd>open single quote</dd><dt><span class="term"><code class="literal">'</code></span></dt><dd>
            apostrophe / close single quote</dd></dl></div>
      <p>
        Additional sequences can be defined by use of the
        <code class="function">h_ligate</code> command: see <a class="link" href="rn01re04.html" title="ponscr-ext">Extensions</a>.
      </p></div>

    <div class="refsect2"><a name="idm139832484192448"></a><h3>Variable interpolation</h3>
      
      <p>
        Unlike in vanilla NScripter, merely including the name of a
        variable in text does not cause it to be interpolated; this is
        because frankly it seems to be more common to want something
        like <code class="literal">$500</code> to be literal text representing a
        sum of money.
      </p><p>
        Instead, variables will be interpolated if enclosed in braces:
        <code class="literal">{$foo}</code>, <code class="literal">{?100[%index]}</code>,
        and so forth.  This is not to be confused with NScripter's
        rather less useful brace syntax (variable assignments), which
        is not supported.
      </p><p>
        The variable's sigil must immediately follow the opening
        brace, and only variables can be interpolated, not arbitrary
        expressions.  To include a literal sequence of a left brace
        followed by a sigil character, use a separator character:
        <code class="literal">{|%</code>.
      </p><p>
        Certain control codes are recognised after variable
        interpolation, since they are parsed at a later stage of
        processing: these are text controls, speed controls, colour
        tags, and ligatures/shortcuts.  In particular, and in contrast
        to NScripter, things like <code class="literal">^!w{%var}</code> will be
        interpreted as a command to wait for however long is specified
        in the given variable.  This should be considered an undefined
        behaviour, and will probably change in future; rather than
        rely on it, you should use the <code class="function">wait</code>
        command (and so forth) for variable timings, and in the
        unlikely event that you actually intend to print the literal
        string <code class="literal">!w</code> followed by the value of
        <em class="replaceable"><code>%var</code></em>, you should write
        <code class="literal">#!w{%var}</code> to avoid ambiguity.
      </p><p>
        Other special sequences are not recognised after
        interpolation.  Variable interpolations are not expanded
        recursively.  Likewise, formatting codes are not processed
        during interpolation; however, if the string literal in which
        they first appeared was delimited with <code class="literal">^</code>
        rather than <code class="literal">"</code>, they will have been
        processed when the string was read, and will therefore work as
        intended.
      </p><p>
        That is to say,
        </p><pre class="programlisting"><code class="function">mov</code> $var, "~b~"
^foo{$var}bar\</pre><p>
        prints </p><pre class="screen">foo~b~bar</pre><p>, while
        </p><pre class="programlisting"><code class="function">mov</code> $var, ^~b~^
^foo{$var}bar\</pre><p>
        prints </p><pre class="screen">foo<span class="strong"><strong>bar</strong></span></pre><p>.
      </p></div>
  </div>

  <div class="refsect1"><a name="idm139832484475120"></a><h2>Bugs</h2>
    
    <p>
      This whole syntax may be considered a bug: it is inconvenient,
      irregular, and needlessly difficult to parse.  Don't blame me: I
      didn't design it, I'm just documenting it.  If you want a
      similar tool with sane syntax, try something like Ren'Py.
    </p></div>

  <div class="refsect1"><a name="idm139832484178560"></a><h2>See also</h2>
    
    <p><a class="link" href="rn01re01.html" title="ponscripter">Overview</a></p></div>
  
</div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="rn01re02.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="rn01.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="rn01re04.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">ponscr </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> ponscr-ext</td></tr></table></div></body></html>
